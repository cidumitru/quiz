<div class="page-container">
    <div class="page-header">
        <h1>Question Banks</h1>
        <div class="header-actions">
        <button mat-button appearance="outlined" (click)="uploadQuestionBank()">
            Import<mat-icon>upload_file</mat-icon>
        </button>
        <button mat-button appearance="filled" color="primary" (click)="newQuestionBank()">
            New<mat-icon>add</mat-icon>
        </button>
        <button mat-button appearance="outlined" [matMenuTriggerFor]="menu">
            <mat-icon>settings</mat-icon> Columns
        </button>
        <mat-menu #menu="matMenu">
            <mat-selection-list (selectionChange)="onColumnToggle($event)">
                @for (column of tableColumnOptions; track column) {
                    <mat-list-option [value]="column" [selected]="column.visible" (click)="$event.stopPropagation()">
                        {{column.name}}
                    </mat-list-option>
                }
            </mat-selection-list>
        </mat-menu>
        </div>
    </div>

    <div class="cards-container">
        @if (questionBanksDs.data.length === 0) {
            <div class="no-data-card">
                <mat-card>
                    <mat-card-content>
                        <div class="no-data-content">
                            <mat-icon>quiz</mat-icon>
                            <h3>No question banks</h3>
                            <p>Create your first question bank to get started</p>
                        </div>
                    </mat-card-content>
                </mat-card>
            </div>
        } @else {
            @for (element of questionBanksDs.data; track element.id) {
                <mat-card class="question-bank-card">
                    <mat-card-header>
                        <mat-card-title>
                            <span class="bank-name" routerLink="banks/{{element.id}}">
                                {{element.name}}
                            </span>
                        </mat-card-title>
                        <mat-card-subtitle>
                            {{element.questions}} questions â€¢ Updated {{(element.updatedAt | date: "short") ?? "Never"}}
                        </mat-card-subtitle>
                    </mat-card-header>
                    
                    <mat-card-content>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-label">Coverage</div>
                                <div class="stat-value primary">{{element.coverage | number}}%</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Avg Score</div>
                                <div class="stat-value">{{element.averageScore | number}}%</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Today</div>
                                <div class="stat-value">{{element.averageScoreToday | number}}%</div>
                            </div>
                        </div>
                        
                        <div class="detailed-stats">
                            <span class="stat-chip" matTooltip="Total answers">
                                <mat-icon>quiz</mat-icon>
                                {{element.stats.totalAnswers}}
                            </span>
                            <span class="stat-chip" matTooltip="Answers on valid questions">
                                <mat-icon>check_circle</mat-icon>
                                {{element.stats.answeredQuestions}}
                            </span>
                            <span class="stat-chip" matTooltip="Correct answers">
                                <mat-icon>verified</mat-icon>
                                {{element.stats.correctAnswers}}
                            </span>
                        </div>
                    </mat-card-content>
                    
                    <mat-card-actions>
                        <button [disabled]="element.questions === 0"
                                [matMenuTriggerFor]="menu"
                                mat-button
                                appearance="outlined"
                                color="primary">
                            <mat-icon>school</mat-icon>
                            Practice
                        </button>
                        <mat-menu #menu="matMenu">
                            <mat-selection-list [multiple]="false" #selectionList>
                                @for (priority of questionPriorityOptions; track priority) {
                                    <mat-list-option (click)="$event.stopPropagation()" [value]="priority" [selected]="priority === questionPriorityOptions[2]">
                                        {{priority.name}}
                                    </mat-list-option>
                                }
                            </mat-selection-list>
                            <mat-divider></mat-divider>
                            @for (size of [25, 50, 100]; track size) {
                                <button (click)="practiceQuiz(element.id, size, selectionList.selectedOptions.selected)"
                                        mat-menu-item>{{size}} Questions
                                </button>
                            }
                        </mat-menu>
                        
                        <button mat-button appearance="outlined" (click)="downloadQuestionBank(element.id);" matTooltip="Download question bank">
                            <mat-icon>download</mat-icon>
                            Download
                        </button>
                        
                        <button mat-icon-button color="warn" (click)="deleteQuiz(element.id);" matTooltip="Delete">
                            <mat-icon>delete</mat-icon>
                        </button>
                    </mat-card-actions>
                </mat-card>
            }
        }
    </div>
</div>