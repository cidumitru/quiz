import{a as y}from"./chunk-MNPMLYZV.js";import{O as p,S as g,Uc as _,ca as d,m as n,n as h,yb as l}from"./chunk-WL6JEFOM.js";import{a as i,b as r,e as q,g as a}from"./chunk-WR2VUDLS.js";var c=q(y());var k=class o{api=g(_);_questionBanks=d({});questionBanks=l(()=>this._questionBanks());questionBankArr=l(()=>(0,c.values)(this._questionBanks()));_loading=d(!1);loading=l(()=>this._loading());_error=d(null);error=l(()=>this._error());get questionBanksValue(){return this._questionBanks()}getQuestionBank(e){return this.api.get(e).pipe(h(t=>t.questionBank))}reload(){return a(this,null,function*(){this._loading.set(!0),this._error.set(null);try{let e=yield n(this.api.list()),t={};e.questionBanks.forEach(s=>{t[s.id]=s}),this._questionBanks.set(t)}catch(e){this._error.set("Failed to load question banks"),console.error("Failed to load question banks:",e)}finally{this._loading.set(!1)}})}create(){return a(this,null,function*(){this._loading.set(!0),this._error.set(null);try{let t=(yield n(this.api.create())).questionBank;return this._questionBanks.update(s=>r(i({},s),{[t.id]:m(t)})),t.id}catch(e){throw this._error.set("Failed to create question bank"),console.error("Failed to create question bank:",e),e}finally{this._loading.set(!1)}})}updateQuestionBank(e,t){return a(this,null,function*(){this._loading.set(!0),this._error.set(null);try{yield n(this.api.update(e,{name:t})),this._questionBanks.update(s=>r(i({},s),{[e]:r(i({},s[e]),{name:t})}))}catch(s){throw this._error.set("Failed to update question bank"),console.error("Failed to update question bank:",s),s}finally{this._loading.set(!1)}})}insertQuestionBank(e){return a(this,null,function*(){this._error.set(null);try{let t=yield n(this.api.insert(e));this._questionBanks.update(s=>r(i({},s),{[t.questionBank.id]:m(t.questionBank)}))}catch(t){throw this._error.set("Failed to insert question bank"),console.error("Failed to insert question bank:",t),t}})}addQuestion(e,t){return a(this,null,function*(){this._loading.set(!0),this._error.set(null);try{yield n(this.api.addQuestion(e,{questions:t})),this._questionBanks.update(s=>r(i({},s),{[e]:r(i({},s[e]),{updatedAt:new Date})}))}catch(s){throw this._error.set("Failed to add question"),console.error("Failed to add question:",s),s}finally{this._loading.set(!1)}})}delete(e){return a(this,null,function*(){this._error.set(null);try{yield n(this.api.delete(e)),this._questionBanks.update(t=>(0,c.omit)(t,e))}catch(t){throw this._error.set("Failed to delete question bank"),console.error("Failed to delete question bank:",t),t}})}setCorrectAnswer(e,t,s){return a(this,null,function*(){this._loading.set(!0),this._error.set(null);try{yield n(this.api.setCorrectAnswer(e,t,s)),this._questionBanks.update(u=>r(i({},u),{[e]:r(i({},u[e]),{updatedAt:new Date})}))}catch(u){throw this._error.set("Failed to set correct answer"),console.error("Failed to set correct answer:",u),u}finally{this._loading.set(!1)}})}deleteQuestion(e,t){return a(this,null,function*(){this._loading.set(!0),this._error.set(null);try{yield n(this.api.deleteQuestion(e,t)),this._questionBanks.update(s=>r(i({},s),{[e]:r(i({},s[e]),{updatedAt:new Date})}))}catch(s){throw this._error.set("Failed to delete question"),console.error("Failed to delete question:",s),s}finally{this._loading.set(!1)}})}static \u0275fac=function(t){return new(t||o)};static \u0275prov=p({token:o,factory:o.\u0275fac})};function m(o){return{id:o.id,name:o.name,createdAt:o.createdAt,updatedAt:o.updatedAt,questionsCount:o.questions.length,statistics:o.statistics}}export{k as a};
