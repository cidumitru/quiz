import{L as n,O as l,R as c,Wc as p,d as u,k as r,w as s}from"./chunk-WL6JEFOM.js";var h=class a{constructor(e){this.authApiService=e;this.initializeAuth()}currentUserSubject=new u(null);isLoggedInSubject=new u(!1);currentUser$=this.currentUserSubject.asObservable();isLoggedIn$=this.isLoggedInSubject.asObservable();requestOtp(e){let t={email:e};return this.authApiService.requestOtp(t).pipe(s(i=>(console.error("Request OTP failed:",i),r(()=>i))))}verifyOtp(e,t){let i={email:e,code:t};return this.authApiService.verifyOtp(i).pipe(n(o=>{this.setAuthData(o)}),s(o=>(console.error("Verify OTP failed:",o),r(()=>o))))}refreshToken(){let e=this.getRefreshToken();return e?this.authApiService.refreshToken({refreshToken:e}).pipe(n(t=>{this.setAuthData(t)}),s(t=>(console.error("Refresh token failed:",t),this.logout(),r(()=>t)))):r(()=>new Error("No refresh token available"))}getUserProfile(){return this.authApiService.getUserProfile().pipe(s(e=>(console.error("Get user profile failed:",e),e.status===401&&this.logout(),r(()=>e))))}initializeAuth(){let e=this.getToken(),t=this.getStoredUser();e&&t&&(this.currentUserSubject.next(t),this.isLoggedInSubject.next(!0))}logout(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),this.currentUserSubject.next(null),this.isLoggedInSubject.next(!1)}deleteAccount(){return this.authApiService.deleteUserProfile().pipe(n(()=>{this.logout()}),s(e=>(console.error("Delete account failed:",e),r(()=>e))))}getToken(){return localStorage.getItem("accessToken")}getRefreshToken(){return localStorage.getItem("refreshToken")}isAuthenticated(){let e=this.getToken();return!!e&&!this.isTokenExpired(e)}setAuthData(e){localStorage.setItem("accessToken",e.accessToken),localStorage.setItem("refreshToken",e.refreshToken),localStorage.setItem("user",JSON.stringify(e.user)),this.currentUserSubject.next(e.user),this.isLoggedInSubject.next(!0)}getStoredUser(){let e=localStorage.getItem("user");return e?JSON.parse(e):null}isTokenExpired(e){try{return JSON.parse(atob(e.split(".")[1])).exp*1e3<Date.now()}catch{return!0}}static \u0275fac=function(t){return new(t||a)(c(p))};static \u0275prov=l({token:a,factory:a.\u0275fac,providedIn:"root"})};export{h as a};
